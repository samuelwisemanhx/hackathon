# Story 1.5: Registration and Login UI

## Status
Draft

## Story
**As a** new or returning user,
**I want** clean, functional registration and login screens,
**so that** I can create an account or access my existing account.

## Acceptance Criteria

1. `/register` page displays registration form with email and password fields
2. `/login` page displays login form with email and password fields
3. Form validation provides real-time feedback for email format and password requirements
4. Submit buttons show loading state during API calls
5. Error messages from API are displayed clearly to the user
6. Successful registration redirects to login page with success message
7. Successful login redirects to dashboard/assessment home
8. Links between registration and login pages allow easy navigation
9. Forms are keyboard accessible and work on mobile devices
10. Password fields include show/hide toggle for usability

## Tasks / Subtasks

- [ ] Create registration page (AC: 1, 3, 4, 5, 6, 8, 9, 10)
  - [ ] Create `src/routes/register/+page.svelte`
  - [ ] Build form with email and password inputs
  - [ ] Implement client-side validation with Zod
  - [ ] Add real-time validation feedback
  - [ ] Add password show/hide toggle
  - [ ] Implement form submission to `/api/auth/register`
  - [ ] Show loading spinner during submission
  - [ ] Display API error messages
  - [ ] Redirect to /login on success with toast/message
  - [ ] Add link to login page
  - [ ] Ensure keyboard navigation works

- [ ] Create login page (AC: 2, 3, 4, 5, 7, 8, 9, 10)
  - [ ] Create `src/routes/login/+page.svelte`
  - [ ] Build form with email and password inputs
  - [ ] Implement client-side validation with Zod
  - [ ] Add real-time validation feedback
  - [ ] Add password show/hide toggle
  - [ ] Implement form submission to `/api/auth/login`
  - [ ] Show loading spinner during submission
  - [ ] Display API error messages
  - [ ] Redirect to /dashboard on success
  - [ ] Add link to registration page
  - [ ] Ensure keyboard navigation works

- [ ] Create shared form components
  - [ ] Create reusable Input component with validation states
  - [ ] Create PasswordInput component with show/hide toggle
  - [ ] Create Button component with loading state
  - [ ] Create ErrorMessage component

- [ ] Add mobile responsiveness (AC: 9)
  - [ ] Test forms on mobile viewport
  - [ ] Ensure touch-friendly input sizes
  - [ ] Verify keyboard appears correctly on mobile

- [ ] Write component tests
  - [ ] Test form validation works
  - [ ] Test API error display
  - [ ] Test loading states
  - [ ] Test successful redirects
  - [ ] Test accessibility (keyboard navigation)

## Dev Notes

### Previous Story Insights
[Source: Story 1.3, 1.4]
- Registration endpoint: POST `/api/auth/register` (email, password)
- Login endpoint: POST `/api/auth/login` (email, password)
- Error format: `{error: {code, message, details}}`
- Successful login sets session cookie automatically

### Frontend Architecture
[Source: architecture/frontend-architecture.md#routing-structure]

**Route Structure:**
```
src/routes/
‚îú‚îÄ‚îÄ register/
‚îÇ   ‚îî‚îÄ‚îÄ +page.svelte
‚îî‚îÄ‚îÄ login/
    ‚îî‚îÄ‚îÄ +page.svelte
```

**State Management:** Svelte 5 runes ($state, $derived)
**Styling:** Tailwind CSS + shadcn-svelte components

### Component Organization
[Source: architecture/frontend-architecture.md#component-organization]

**UI Components Location:** `src/lib/components/ui/` (shadcn-svelte)
**Shared Components:** `src/lib/components/shared/`

**Use shadcn-svelte components:**
- Input, Button, Label from ui/ folder
- Follow shadcn-svelte patterns for consistency

### Form Validation
[Source: architecture/tech-stack.md]

**Validation:** Zod (shared schemas between client/server)

**Shared Schema Location:** `src/lib/utils/validation.ts`

```typescript
// src/lib/utils/validation.ts
import { z } from 'zod';

export const registerSchema = z.object({
  email: z.string().email('Invalid email format'),
  password: z.string().min(8, 'Password must be at least 8 characters')
});

export const loginSchema = z.object({
  email: z.string().email('Invalid email format'),
  password: z.string().min(1, 'Password is required')
});
```

### API Client Pattern
[Source: architecture/coding-standards.md#critical-fullstack-rules]

**CRITICAL:** "Frontend NEVER makes direct fetch calls - use API client service"

**API Client Location:** `src/lib/services/api.ts`

```typescript
// src/lib/services/api.ts
export async function registerUser(email: string, password: string) {
  const response = await fetch('/api/auth/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error.message);
  }

  return response.json();
}

export async function loginUser(email: string, password: string) {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error.message);
  }

  return response.json();
}
```

### Registration Page Implementation

```svelte
<!-- src/routes/register/+page.svelte -->
<script lang="ts">
  import { goto } from '$app/navigation';
  import { registerUser } from '$lib/services/api';
  import { registerSchema } from '$lib/utils/validation';
  import Button from '$lib/components/ui/button/button.svelte';
  import Input from '$lib/components/ui/input/input.svelte';
  import Label from '$lib/components/ui/label/label.svelte';

  let email = $state('');
  let password = $state('');
  let showPassword = $state(false);
  let loading = $state(false);
  let error = $state('');
  let validationErrors = $state<Record<string, string>>({});

  async function handleSubmit(e: Event) {
    e.preventDefault();
    error = '';
    validationErrors = {};
    loading = true;

    // Validate
    const result = registerSchema.safeParse({ email, password });
    if (!result.success) {
      validationErrors = result.error.flatten().fieldErrors;
      loading = false;
      return;
    }

    try {
      await registerUser(email, password);
      // Redirect to login with success message
      goto('/login?registered=true');
    } catch (err) {
      error = err instanceof Error ? err.message : 'Registration failed';
    } finally {
      loading = false;
    }
  }
</script>

<div class="container max-w-md mx-auto py-8">
  <h1 class="text-2xl font-bold mb-6">Create Account</h1>

  <form onsubmit={handleSubmit}>
    <div class="mb-4">
      <Label for="email">Email</Label>
      <Input
        id="email"
        type="email"
        bind:value={email}
        aria-invalid={!!validationErrors.email}
      />
      {#if validationErrors.email}
        <p class="text-sm text-red-500 mt-1">{validationErrors.email}</p>
      {/if}
    </div>

    <div class="mb-4">
      <Label for="password">Password</Label>
      <div class="relative">
        <Input
          id="password"
          type={showPassword ? 'text' : 'password'}
          bind:value={password}
          aria-invalid={!!validationErrors.password}
        />
        <button
          type="button"
          class="absolute right-2 top-2"
          onclick={() => showPassword = !showPassword}
        >
          {showPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è'}
        </button>
      </div>
      {#if validationErrors.password}
        <p class="text-sm text-red-500 mt-1">{validationErrors.password}</p>
      {/if}
    </div>

    {#if error}
      <p class="text-sm text-red-500 mb-4">{error}</p>
    {/if}

    <Button type="submit" disabled={loading} class="w-full">
      {loading ? 'Creating Account...' : 'Register'}
    </Button>
  </form>

  <p class="mt-4 text-center">
    Already have an account? <a href="/login" class="text-blue-600 hover:underline">Log in</a>
  </p>
</div>
```

### Login Page Implementation

Similar structure to registration page but:
- Call `loginUser()` instead
- Redirect to `/dashboard` on success
- Less strict password validation (just required, not min length)
- Link to `/register` page

### Mobile Responsiveness
[Source: architecture/tech-stack.md]

**CSS Framework:** Tailwind CSS 3.x

**Mobile-First Classes:**
- Use `container mx-auto` for centering
- Use `max-w-md` to limit form width
- Ensure touch targets are at least 44x44px
- Test on viewport widths: 320px, 375px, 768px

### Accessibility
[Source: architecture/tech-stack.md]

**WCAG AA Compliance Required:** shadcn-svelte provides accessible primitives

**Requirements:**
- All inputs have associated labels
- Error messages use aria-invalid
- Forms are keyboard navigable (tab order)
- Submit on Enter key
- Focus management on validation errors

### Testing
[Source: architecture/tech-stack.md]

**Framework:** Vitest for component tests, Playwright for E2E

**Test Files:**
- `tests/components/register.test.ts`
- `tests/components/login.test.ts`
- `tests/e2e/auth-flow.spec.ts`

**Test Scenarios:**
- Form validation catches invalid inputs
- Loading state shows during submission
- Error messages display correctly
- Successful flows redirect properly
- Password toggle works
- Keyboard navigation works
- Mobile viewport renders correctly

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
